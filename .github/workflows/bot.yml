name: Deploy to Server

on:
  push:
    branches:
      - main  # main ë¸Œëœì¹˜ì— Pushí•˜ë©´ ì‹¤í–‰ë¨

jobs:
  deploy:
    runs-on: ubuntu-latest  # GitHub Actions ì‹¤í–‰ í™˜ê²½

    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v3  # ìµœì‹  ì½”ë“œ ê°€ì ¸ì˜¤ê¸°

      - name: ğŸ”‘ Setup SSH Connection
        uses: appleboy/ssh-action@master  # SSHë¥¼ ì‚¬ìš©í•˜ì—¬ ì„œë²„ì— ì ‘ì†
        with:
          host: ${{ secrets.SERVER_HOST }}  # GitHub Secretsì—ì„œ ì„œë²„ IP ê°€ì ¸ì˜¤ê¸°
          username: ${{ secrets.SERVER_USER }}  # ì„œë²„ ì‚¬ìš©ì ì´ë¦„
          key: ${{ secrets.SERVER_SSH_KEY }}  # ì„œë²„ ì ‘ì† SSH í‚¤
          script: |
            echo "âœ… ì—°ê²° ì„±ê³µ!"
            cd /home/o3osaham/dx3bot  # ë´‡ì´ ìˆëŠ” ë””ë ‰í† ë¦¬ë¡œ ì´ë™
            echo "DISCORD_BOT_TOKEN=${{ secrets.DISCORD_BOT_TOKEN }}" > .env  # í™˜ê²½ ë³€ìˆ˜ ì €ì¥
            export DISCORD_BOT_TOKEN=${{ secrets.DISCORD_BOT_TOKEN }}  # í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
            source ~/.bashrc  # í™˜ê²½ ë³€ìˆ˜ ì ìš©
            npm install  # íŒ¨í‚¤ì§€ ì„¤ì¹˜
            pm2 restart dx3bot || pm2 start dx3bot.js --name "dx3bot"  # PM2ë¡œ ë´‡ ì‹¤í–‰
